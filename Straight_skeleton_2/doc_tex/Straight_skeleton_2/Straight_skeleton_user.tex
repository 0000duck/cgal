%% Copyright (c) 2004  SciSoft.  All rights reserved.
%%
%% This file is part of CGAL (www.cgal.org); you may redistribute it under
%% the terms of the Q Public License version 1.0.
%% See the file LICENSE.QPL distributed with CGAL.
%%
%% Licensees holding a valid commercial license may use this file in
%% accordance with the commercial license agreement provided with the software.
%%
%% This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE
%% WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.
%%
%% 
%%
%% Author(s)     : Fernando Cacciola <fernando_cacciola@hotmail.com>

\section{Definitions}

\subsection{2D Contour}

A {\em 2D contour} is a closed sequence (a cycle) of 3 or more \textit{connected 2D oriented straight line segments} called {\em contour ddges}. The endpoints of the contour edges are called {\em vertices}. Each contour edge shares its endpoints with at least two other contour edges.\\
If the edges are pairwise disjoint; that is, if they intersect only at the vertices or entirely, the contour is classified as {\em simple}.\\
A contour is topologically equivalent to a \textit{disk} and a simple contour is a kind of \textit{Jordan Curve}.\\
Contours parition the plane in one bounded and one unbounded open regions. If the bounded region of a contour is a \textit{singly-connected set}, the contour is said to be {\em strictly simple}.\\
The \ccc{Orientation} of a contour is given by the order of the vertices around its interior. It can be \ccc{Clockwise} (CCW) or \ccc{Counterclockwise} (CW).\\
The {\em bounded side} of a contour edge is the side facing to the bounded region of the contour. If the contour is oriented CCW, the bounded side of am edge is the left side.

A contour with a null edge (a segment of length zero given by two consecutive coincident vertices), or with edges not connected to the bounded region (an antenna: 2 consecutive edges going forth and back along the same line), is said to be {\em degenerate} (collinear edges are \textit{not} considered a denerancy).

\subsection{2D Polygon with Holes}

A 2D Polygon is a contour.\\
A 2D {\em polygon with holes} is a contour, called the {\em outer contour}, having zero or more countours, called {\em inner contours}, or {\em holes}, in its bounded region. The intersection of the bounded region of the outer contour and the unbounded regions of each inner contour is the {\em interior} of the polygon with holes. The orientation of holes must be opposite to the orientation of the outer contour and there cannot be any intersection among all the contours. A hole cannot be in the bounded region of any other hole.\\
A polygon with holes is Strictly Simple if its interior is a singly-connected set.\\
The Orientation of a Polygon with Holes is the orientation of its outer contour. The bounded side of \textit{any} edge, whether of the outer contour or a hole, is the \textit{same} for all edges. That is, if the outer contour is oriented CCW and the holes CW, both contour and hole edges face the polygon interior to their left.\\

Througout the rest of this chapter the term Polygon will be used as a shortcut for Polygon with Holes.
 
\subsection{Inward Offset of a Non-degenerate Strictly Simple Polygon with Holes}

For any 2D non-degenerate strictly-simple polygon with holes called the {\em source}, there can exist a \textit{set} of 0, 1 or more {\em inward offset polygons with holes}, or just offset polygons for short, at some euclidean distance \textit{t} $>0$ (each being strictly simple and non-degenerate). Any contour edge of such offset polygon, called an {\em offset edge} corresponds to \textit{some} contour edge of the source polygon, called its {\em source edge}. An offset edge is parallel to its source edge and has the same orientation. The Euclidean distance between the \textit{lines} supporting an offset edge and its source edge is exactly \ccc{t}.\\
An offset edge is always located to the bounded side of its source edge (which is an oriented straight line segment).\\
An offset polygon can have less, equal or more sides as its source polygon.\\
If the source polygon has no holes, no offset polygon has holes. If the source polygon has holes, any of the offset polygons can have holes itself, but it might as well have no holes at all (if the distance is sufficiently large).\\
Each offset polygon has the same orientation of the source polygon.

\begin{figure}[htbp]
\begin{ccTexOnly}
\begin{center}
\includegraphics{Straight_skeleton_2/fig0} % omit suffix .eps to supprt PS and PDF
\includegraphics{Straight_skeleton_2/fig1} % omit suffix .eps to supprt PS and PDF
\end{center}
\end{ccTexOnly}
\begin{ccHtmlOnly}
<TABLE CELLSPACING=40>
<TR>
<TD>
<CENTER>
<IMG BORDER=0 SRC="./fig0.png" ALIGN=center ALT="Polygon with no holes and 2 inward offsets">
</CENTER>
</TD>
<TD>
<CENTER>
<IMG BORDER=0 SRC="./fig1.png" ALIGN=center ALT="polygon with holes and many inward offsets at various distances">
</CENTER>
</TD>
</TR>
</TABLE>
\end{ccHtmlOnly}
\caption{Polygon with no holes and 2 inward offsets at distances 1 and 2 (Left) 
         and polygon with holes and many inward offsets at various distances (Right)
\label{Simplepoly-offsets}}
\end{figure}

\subsection{Straight Skeleton of a 2D Non-degenerate Strictly-Simple Polygon with Holes}
 
The {\em 2D straight skeleton} of a non-degenerate strictly-simple polygon with holes \cite{aaag-ntsp-95} is a special partitioning of the polygon interior into {\em straight skeleton regions} corresponding to the monotone areas traced by a continuous \textit{inward offsetting} of the contour edges. Each region corresponds to exactly 1 contour edge.\\
These regions are bounded by angular bisectors of the supporting lines of the contour edges and each such region is a non-convex non-degenerate strictly-simple polygon itself.

\begin{figure}[htbp]
\begin{ccTexOnly}
\begin{center}
\includegraphics{Straight_skeleton_2/fig2} % omit suffix .eps to supprt PS and PDF
\includegraphics{Straight_skeleton_2/fig3} % omit suffix .eps to supprt PS and PDF
\end{center}
\begin{center}
\includegraphics{Straight_skeleton_2/fig4} % omit suffix .eps to supprt PS and PDF
\includegraphics{Straight_skeleton_2/fig5} % omit suffix .eps to supprt PS and PDF
\end{center}
\end{ccTexOnly}

\begin{ccHtmlOnly}
<TABLE CELLSPACING=40>
<TR>
<TD>
<CENTER>
<IMG BORDER=0 SRC="./fig2.png" ALIGN=center ALT="Sample Skeleton 0">
</CENTER>
</TD>
<TD>
<CENTER>
<IMG BORDER=0 SRC="./fig3.png" ALIGN=center ALT="Sample Skeleton 1">
</CENTER>
</TD>
</TR>
<TR>
<TD>
<CENTER>
<IMG BORDER=0 SRC="./fig4.png" ALIGN=center ALT="Sample Skeleton 0">
</CENTER>
</TD>
<TD>
<CENTER>
<IMG BORDER=0 SRC="./fig5.png" ALIGN=center ALT="Sample Skeleton 1">
</CENTER>
</TD>
</TR>
</TABLE>
\end{ccHtmlOnly}

\caption{Example straight skeletons
\label{SampleSLS}}
\end{figure}
  
\subsubsection{Angular Bisecting Lines and Offset Bisectors}  

Given two points and a line passing through them, the perpendicular line passing through the midpoint is the bisecting line (or bisector) of those points.

Two non-parallel lines, intersecting at a point, are bisected by two
other lines passing through that intersection point.

Two parallel lines are bisected by another parallel line placed
halfway in between.

Given just one line, any perpendicular line can be considered the
bisecting line (any bisector of any two points along the single line).

The bisecting lines of two edges are the lines bisecting the
supporting lines of the edges (if the edges are parallel or collinear,
there is just one bisecting line).

The halfplane to the bounded side of the line supporting a contour edge is
called the {\em offset zone} of the contour edge.

Given any number of contour edges (not necessarily consecutive), the
intersection of their offset zones is called their {\em combined
offset zone}.

Any two contour edges define an {\em offset bisector}, as follows: If
the edges are non-parallel, their bisecting lines can be decomposed as
4 rays originating at the intersection of the supporting lines. Only
one of these rays is contained in the combined offset zone of the
edges (which one depends on the possible combinations of
orientations). This ray is the offset bisector of the non-parallel
contour edges.

If the edges are parallel (but not collinear) and have opposite
orientation, the entire and unique bisecting line is their offset
bisector. If the edges are parallel but have the same orientation,
there is no offset bisector between them.

If the edges are collinear and have the same orientation, their offset
bisector is given by a perpendicular ray to the left of the edges
which originates at the midpoint of the combined complement of
the edges. (The {\em complement} of an edge/segment are the two
rays along its supporting line which are not the segment and the
{\em combined complement} of \ccc{N} collinear segments is the
intersection of the complements of each segment). If the edges are
collinear but have opposite orientation, there is no offset bisector
between them.

%% Figure of bisecting lines and offset bisectors here

\subsubsection{Faces, Edges and Vertices}

Each region of the partitioning defined by a straight skeleton is
called a {\em face}. Each face is bounded by straight line segments,
called {\em edges}. Exactly one edge per face is a {\em contour edge}
(corresponds to a side of the polygon) and the rest of the edges,
located in the interior of the polygon, are called {\em skeleton
edges}, or {\em bisectors}.

The bisectors of the straight skeleton are segments of the offset
bisectors as defined previously. Since an offset bisector is a ray of
a bisecting line of 2 contour edges, each skeleton edge (or bisector)
is uniquely given by two contour edges. These edges are called the
{\em defining contour edges} of the bisector.

The intersection of the edges are called {\em vertices}. Although in a
simple polygon, only 2 edges intersect at a vertex, in a straight
skeleton, 3 edges intersect a any given vertex. That is, vertices in a
straight skeleton have degree 3.

A {\em contour vertex} is a vertex for which 2 of its incident edges are contour edges.

A {\em skeleton vertex} is a vertex who's incident edges are all skeleton edges.

A {\em contour bisector} is a bisector who's defining contour edges
are consecutive. Such a bisector is incident upon 1 contour vertex and
1 skeleton vertex and touches the input polygon at exactly 1 endpoint.

An {\em inner bisector} is a bisector who's defining contour edges are
not consecutive. Such a bisector is incident upon 2 skeleton vertices
and is strictly contained in the interior of the polygon.

\section{Representation}

This \cgal\ package represents a straight skeleton as a specialized \ccc{Halfedge Data Structure} (HDS) whose vertices embeds 2D Points (see the \ccc{StraightSkeleton_2} concept in the reference manual for details).

Its halfedges, by considering the source and target points, implicitly embeds 2D oriented straight line segments. 

A face of the straight skeleton is represented as a face in the
HDS. Both contour and skeleton edges are represented by pairs of
opposite HDS halfedges, and both contour and skeleton vertices are
represented by HDS vertices.

In a HDS, a border halfedge is a halfedge which is incident upon an
unbounded face. In the case of the straight skeleton HDS, such border
halfedges are oriented such that their left side faces outwards the
polygon. Therefore, the opposite halfedge of any border halfedge is
oriented such that its left side faces inward the polygon.

This \cgal\ package requires the input polygon (with holes) to be non-degenerate, strictly-simple, and oriented counter-clockwise.

The skeleton halfedges are oriented such that their \textit{left} side faces
inward the region they bound. That is, the vertices (both contour and
skeleton) of a face are circulated in counter-clockwise order. There
is one and only one contour halfedge incident upon any face.

The contours of the input polygon are traced by the border halfedges 
of the HDS (those facing outward), but in the opposite direction. That 
is, the vertices of the contours can only by traced from the straight
skeleton data structure by circulating the border halfedges,
and the resulting vertex sequence will be reversed w.r.t 
the input vertex sequence.

A skeleton edge, according to the definition given in the previous
section, is defined by 2 contour edges. In the representation, each
one of the opposite halfedges that represent a skeleton edge is
associated with one of the opposite halfedges that correspond to one
of its defining contour edges. Thus, the 2 opposite halfedges of a
skeleton edge link the edge to its 2 defining contour edges.

Starting from any border contour halfedge, circulating the structure
walks through border counter halfedges and traces the vertices of the
polygon's contours (in opposite order).

Starting from any non-border but contour halfedge, circulating the
structure walks counter-clockwise around the face corresponding
to that contour halfedge. The vertices around a face always describe
a non-convex non-degenerate strictly-simple polygon.

A vertex is the intersection of contour and/or skeleton edges. Since a
skeleton edge is defined by 2 contour edges, any vertex is itself
defined by a unique set of contour edges. These are called the
{\em defining contour edges} of the vertex.

A vertex is identified by it's set of defining contour edges. Two
vertices are distinct if they have differing sets of defining contour
edges.  Note that vertices can be distinct even if they are geometrically
embedded at the same point.
 
Contour vertices have exactly two defining contour edges, which are
the contour edges incident upon the vertex; while skeleton vertices
have exactly 3 defining contour edges.

The Euclidean distance from any vertex to the lines
supporting its defining contour edges is the same for all such lines
(this is the distinctive characteristic of a straight skeleton). This
distance is called the {\em time} of the vertex. Note that
different vertices can have the same time. Contour vertices have time
zero.

\begin{figure}[htbp]
\begin{ccTexOnly}
\begin{center}
\includegraphics{Straight_skeleton_2/fig6} % omit suffix .eps to supprt PS and PDF
\end{center}
\end{ccTexOnly}

\begin{ccHtmlOnly}
<TABLE CELLSPACING=40>
<TR>
<TD>
<CENTER>
<IMG BORDER=0 SRC="./fig6.png" ALIGN=center ALT="Straight skeleton DS">
</CENTER>
</TD>
</TR>
</TABLE>
\end{ccHtmlOnly}

\caption{Straight Skeleton Data Structure
\label{Simplepoly-offsets}}
\end{figure}

\section{API}

The straight skeleton data structure is defined by the \ccc{StraightSkeleton_2} concept and modeled in the \ccc{Straight_skeleton_2<Traits,Items,Alloc>} class.

The straight skeleton construction algorithm is encapsulated in the
class \ccc{Straight_skeleton_builder_2<Gt,Ss>} which is
parameterized on a geometric traits (class
\ccc{Straight_skeleton_builder_traits<Kernel>}) and the Straight
Skeleton class (Ss).

The polygon offset construction algorithm is encapsulated in the class
\ccc{Polygon_offset_builder_2<Ss,Gt,Container>} which is
parameterized on the Straight Skeleton class (Ss), a
geometric traits (class \ccc{Polygon_offset_builder_traits<Kernel>})
and a container type where the resulting offset polygons are
generated.

To construct the straight skeleton of a simple polygon the user must:
 
(1) Instantiate the straight skeleton builder.

(2) Enter one contour at a time, starting from the outer contour, via
    the method \ccc{enter_contour}. The input polygon with holes must be 
    non-degenerate, strictly-simple and counter-clockwise oriented
    (see the definitions at the beginning of this chapter).
    Collinear edges are allowed. The insertion order of each hole
    is unimportant but the outer contour must be entered first.

(3) Call \ccc{construct_skeleton} once \textit{all} the contours have been entered. You
cannot enter another contour once the skeleton has been constructed.

To construct a set of inward offset contours the user must:
 
(1) Construct the straight skeleton of the source polygon with holes.

(2) Instantiate the polygon offset builder passing in the straight skeleton as a parameter.

(3) Call \ccc{construct_offset_contours} passing the desired offset
    distance and an output iterator that can store a
    \ccc{boost::shared_ptr} of \ccc{Container} instances 
    into a resulting sequence.
    Typically, you'll use a back insertion iterator for that
    (each returned \ccc{Container} instance represents one offset contour
    (a polygon {\em without} holes).

Each element in the resulting sequence is an {\em offset contour}, given by
a \ccc{boost::shared_ptr} holding a dynamically allocated instance 
of the Container type. Such a container can be any model of the 
\ccc{VertexContainer_2} concept, for example, a \ccc{CGAL::Polygon_2}, 
or just a \ccc{std::vector} of 2D points.

The resulting sequence of offset contours can contain both outer and inner contours. 
Each inner contour would logically correspond to some of the outer contours.
However, this algorithm returns a sequence of contours in arbritary order and there is no
indidication whatsoever of the parental relationship between inner and outer contours.

On the other hand, each outer contour is counter-clockwise oriented while each hole is clockwise-oriented.
And since offset contours do form simple polygons with holes, it is guaranteed that no hole will be inside another hole, no outer contour will be inside any other contour, and each hole will be inside exactly 1 outer contour.

Parental relationships are {\em not} automatically reconstructed by this algoritm because this relation is not directly given by the input polygon with holes and doing it \textit{robustly} is a time-consuming operation.

Reconstructing the parental relations can be done by testing each inner contour
(clockwise) against each outer contour (counter-clocwise) for insideness.

This algorithm requires exact predicates but not exact constructions
Therefore, the \ccc{Exact_predicates_inexact_constructions_kernel} should be used.

\subsection{Example}

\ccIncludeExampleCode{../examples/Straight_skeleton_2/Straight_skeleton_2.C}

\section{Straight Skeletons, Medial Axis and Voronoi Diagrams}  

The straight skeleton of a polygon is similar to the medial
axis and the voronoi diagram of a polygon in the way it partitions
it; however, unlike the medial axis and voronoi diagram, the
bisectors are not equidistant to its defining edges but to the
supporting lines of such edges. As a result, Straight Skeleton
bisectors might not be located in the center of the polygon and so
cannot be regarded as a proper Medial Axis in its geometrical meaning.

On the other hand, only reflex vertices (whose internal angle $>pi$)
are the source of deviations of the bisectors from its center
location. Therefore, for convex polygons, the straight skeleton, the
medial axis and the Voronoi diagram are exactly equivalent,
and, if a non-convex polygon contains only vertices of low
reflexivity, the straight skeleton bisectors will be placed nearly
equidistant to their defining edges, producing a straight skeleton
pretty much alike a proper medial axis.

%% Straight Skeleton, Medial Axis and Voronoi Diagram figures here

\section{Straight Skeleton of a General Figure in the Plane}

A straight skeleton can also be defined for a general
multiply-connected planar directed straight-line graph \cite{aa-skfgpf-95} by considering
all the edges as embedded in an unbounded region. The only difference
is that in this case some faces will be only partially bounded.


The current version of this \cgal\ package can only construct the
straight skeleton in the interior of a simple polygon, that is it
doesn't handle general polygonal figures in the plane.

% +------------------------------------------------------------------------+
%%RefPage: end of main body, begin of sfsooter
% EOF
% +------------------------------------------------------------------------+

