% +------------------------------------------------------------------------+
% | Reference manual page: surface_neighbor_coordinates_3.tex
% +------------------------------------------------------------------------+
% | 
% | August 2003  Julia Floetotto
% | Package:   Interpolation
% | 
% |
% +------------------------------------------------------------------------+

%\renewcommand{\ccRefPageBegin}{\begin{ccAdvanced}}
%\renewcommand{\ccRefPageEnd}{\end{ccAdvanced}}
\begin{ccRefFunction}{surface_neighbor_coordinates_3}  %% add template arg's if necessary
\ccIndexSubitemBegin{Interpolation}{surface_neighbor_coordinates_3}

\ccDefinition

The function \ccRefName\ computes natural neighbor coordinates for
surface points associated to a finite set of sample points issued from
the surface. The coordinates are computed from the intersection of the
Voronoi cell of the query point \ccc{p} with the tangent plane to the
surface at \ccc{p}. If the sampling is sufficiently dense, the
coordinate system meets the properties described in the manual pages
and in \cite{bf-lcss-02},\cite{cgal:f-csapc-03}.  The query
point \ccc{p} needs to lie inside the convex hull of the projection of
the sample points onto the tangent plane at \ccc{p}.

\ccInclude{CGAL/surface_neighbor_coordinates_3.h}

\ccFunction{template <class OutputIterator, class InputIterator, class
  Kernel> CGAL::Triple< OutputIterator, typename Kernel::FT, bool >
  surface_neighbor_coordinates_3(InputIterator first, InputIterator
  beyond, const typename Kernel::Point_3& p, const typename
  Kernel::Vector_3& normal, OutputIterator out, const Kernel& K);}{
  The sample points $\mathcal{P}$ are provided in the range
  $\left[\right.$\ccc{first}, \ccc{beyond}$\left.\right)$.
  \ccc{InputIterator::value_type} is the point type
  \ccc{Kernel::Point_3}. The tangent plane is defined by the point
  \ccc{p} and the vector \ccc{normal}.  The parameter \ccc{K}
  determines the kernel type that will instantiate
  the template parameter of \ccc{Voronoi_intersection_2_traits_3<K>}. \\
  The natural neighbor coordinates for \ccc{p} are computed in the
  power diagram that results from the intersection of the $3D$ Voronoi
  diagram of $\mathcal{P}$ with the tangent plane. The sequence of
  point/coordinate pairs that is computed by the function is placed
  starting at \ccc{out}. The function returns a triple with an
  iterator that is placed past-the-end of the resulting sequence of
  point/coordinate pairs, the normalization factor of the coordinates
  and a Boolean value which is set to true iff the coordinate
  computation was successful, i.e. if \ccc{p} lies inside the convex
  hull of the projection of the points $\mathcal{P}$ onto the tangent
  plane.}


\ccFunction{template <class OutputIterator, class InputIterator, class
  ITraits> CGAL::Triple< OutputIterator, typename ITraits::FT, bool >
  surface_neighbor_coordinates_3(InputIterator first, InputIterator
  beyond, const typename ITraits::Point_2& p,OutputIterator out, const
  ITraits& traits);}{ the same as above only that the traits class
  must be instantiated by the user. \ccc{ITraits} must be equivalent
  to \ccc{Voronoi_intersection_2_traits_3<K>}.}


The next functions return, in addition, a second Boolean value (the
fourth value of the quadruple) that certifies whether or not, the
Voronoi cell of \ccc{p} can be affected by points that lie outside the
input range, i.e.\ outside the ball centered on \ccc{p} passing
through the furthest sample point from \ccc{p} in the range
$\left[\right.$\ccc{first}, \ccc{beyond}$\left.\right)$. If the sample
points are collected by a $k$-nearest neighbor or a range search
query, this permits to check whether the neighborhood which has been
considered is large enough.

\ccFunction{template <class OutputIterator, class InputIterator, class
  Kernel> CGAL::Quadruple< OutputIterator, typename Kernel::FT, bool,
  bool > surface_neighbor_coordinates_certified_3(InputIterator first,
  InputIterator beyond, const typename Kernel::Point_3& p, const
  typename Kernel::Vector_3& normal, OutputIterator out, const Kernel&
  K);}{Similar to the first function. The additional fourth return
  value is \ccc{true} if the furthest point in the range
  $\left[\right.$\ccc{first}, \ccc{beyond}$\left.\right)$ is further
  away from \ccc{p} than twice the distance from \ccc{p} to the
  furthest vertex of the intersection of the Voronoi cell of \ccc{p}
  with the tangent plane defined by \ccc{(p,normal)}. It is
  \ccc{false} otherwise.}  \ccFunction{template <class OutputIterator,
  class InputIterator, class Kernel> CGAL::Quadruple< OutputIterator,
  typename Kernel::FT, bool, bool >
  surface_neighbor_coordinates_certified_3(InputIterator first,
  InputIterator beyond, const typename Kernel::Point_2& p, const
  typename Kernel::FT& max_distance, OutputIterator out, const Kernel&
  kernel);} { The same as above except that this function takes the
  maximal distance from p to the points in the range
  $\left[\right.$\ccc{first}, \ccc{beyond}$\left.\right)$ as
  additional parameter.}

\ccFunction{template <class OutputIterator, class InputIterator, class
  ITraits> CGAL::Quadruple< OutputIterator, typename ITraits::FT, bool, bool >
  surface_neighbor_coordinates_certified_3(InputIterator first,
  InputIterator beyond, const typename ITraits::Point_2& p,
  OutputIterator out, const ITraits& traits);}{The same as above only
  that the traits class must be instantiated by the user and without
  the parameter \ccc{max_distance}.  \ccc{ITraits} must be equivalent
  to \ccc{Voronoi_intersection_2_traits_3<K>}.}

\ccFunction{template <class OutputIterator, class InputIterator, class
  ITraits> CGAL::Quadruple< OutputIterator, typename ITraits::FT, bool, bool >
  surface_neighbor_coordinates_certified_3(InputIterator first,
  InputIterator beyond, const typename ITraits::Point_2& p, const
  typename ITraits::FT& max_distance, OutputIterator out, const
  ITraits& traits);} { The same as above with the parameter
  \ccc{max_distance}.}

The next function allows to filter some potential neighbors of the
query point \ccc{p} from $\mathcal{P}$ via its three-dimensional
Delaunay triangulation. All surface neighbors of \ccc{p} are
necessarily neighbors in the Delaunay triangulation of $\mathcal{P}
\cup \{p\}$.  

\ccFunction{template < class Dt, class OutputIterator >
  CGAL::Triple< OutputIterator, typename Dt::Geom_traits::FT, bool >
  surface_neighbor_coordinates_3(const Dt& dt, const typename
  Dt::Geom_traits::Point_2& p, const typename
  Dt::Geom_traits::Vector_3& normal, OutputIterator out, typename
  Dt::Face_handle start = typename Dt::Face_handle());} {computes
  the surface neighbor coordinates with respect to the points that are
  vertices of the Delaunay triangulation \ccc{dt}. The type \ccc{Dt}
  must be equivalent to \ccc{Delaunay_triangulation_3<Gt, Tds>}. The
  optional parameter \ccc{start} is used as a starting
  place for the search of the conflict zone. It may be the result of
  the call \ccc{dt.locate(p)}. This function instantiates the template
  parameter \ccc{ITraits} to be
  \ccc{Voronoi_intersection_2_traits_3<Dt::Geom_traits>}.}


\ccFunction{template < class Dt, class OutputIterator,
  class ITraits> CGAL::Triple< OutputIterator, typename
  Dt::Geom_traits::FT, bool > surface_neighbor_coordinates_3(const Dt& dt,
  const typename Dt::Geom_traits::Point_2& p, OutputIterator out,
  const ITraits& traits, typename Dt::Face_handle start = typename
  Dt::Face_handle());}
%
{The same as above only that the parameter \ccc{traits} instantiates
  the geometric traits class. Its type \ccc{ITraits} must be
  equivalent to \ccc{Voronoi_intersection_2_traits_3<K>}.}

\ccHeading{Requirements}
\begin{enumerate}
\item \ccc{Dt} is equivalent to the class
  \ccc{Delaunay_triangulation_3}.
\item \ccc{OutputIterator::value_type} is equivalent to
  \ccc{std::pair<Dt::Point_3, Dt::Geom_traits::FT>}, i.e.\ a pair
  associating a point and its natural neighbor coordinate.
\item  \ccc{ITraits} is equivalent to the class \ccc{Voronoi_intersection_2_traits_3<K>}.
\end{enumerate}

\ccSeeAlso
\ccRefIdfierPage{CGAL::linear_interpolation} \\
\ccRefIdfierPage{CGAL::sibson_c1_interpolation}\\ 
\ccRefIdfierPage{CGAL::farin_c1_interpolation}\\  
\ccRefIdfierPage{CGAL::Voronoi_intersection_2_traits_3<K>}\\
\ccRefIdfierPage{CGAL::surface_neighbors_3} 

\ccImplementation This functions construct the regular triangulation of the input points 
instantiated with \ccc{Voronoi_intersection_2_traits_3<Kernel>} or \ccc{ITraits} if provided. 
They return the result of the function call 
\ccc{regular_neighbor_coordinates_2} 
with the regular triangulation and \ccc{p} as arguments.

\ccIndexSubitemEnd{Interpolation}{surface_neighbor_coordinates_3}
\end{ccRefFunction}
