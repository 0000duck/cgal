#!/bin/bash

# echo description:
echo "This utility converts all mema-files in the directory data/"
echo "to 'nice, readable' Maple worksheets."
echo ""

# create list of all mema's in directory data/:
FILES=`find data -name '*.mema'`

# check that data2mw binary is available
if [ ! -e data2mw ]; then
    echo "Binary 'data2mw' is not available in the current working directory."
    echo "Trying to build it now..."
    g++ data2mw.C -o data2mw
    if [ ! -e data2mw ]; then
	echo "Building failed, bailing out."
	echo "ERROR: 'data2mw' not available in the current working directory."
	exit -2;
    fi
fi

# process each file:
for file in $FILES
do
  tmp=`basename "$file"`
  mfile=${tmp%.*}
  mfile="${mfile}.mw"
  if [ ! -e $mfile ] || [ $mfile -ot $file ]; then
      echo "Creating file '$mfile' ..."
      ./data2mw "$file" "$mfile"
  else
      echo "File '$mfile' is up-to-date."
  fi
done

# finish:
echo "Done."
exit 0
