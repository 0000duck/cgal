%+-------------------------------------------------------
%| CGAL Manual : pmwx.tex
%+--------------------------------------------------------
%| update log
%|
%| 04 May 2001  - Eyal Flato
%|    Created from arr documentation
%| 15 May 2003  - Efi Fogel
%|    Cleanup
%--------------------------------------------------------

\chapter{2D Planar Maps of Intersecting Curves} \label{I1_ChapterPmwx}
%\minitoc

\section{Introduction}

Given a collection $C$ of (possibly intersecting and not necessarily
$x$-monotone curves in the plane, we construct a collection $C''$ in
two steps, as follows: First, we decompose each curve in C into
maximal x-monotone curves, thus obtaining the collection
$C'$. Second, We decompose each curve in $C'$ into maximal connected
pieces not intersecting any other curve in $C'$.  This way we obtain
the collection $C''$ of $x$-monotone, pairwise interior disjoint
curves.  Constructing the {\it planar map with intersection} of the
curves in $C$ gives the {\it planar map}(see
Chapter~\ref{I1_ChapterPlanarMap}) induced by the curves in $C''$.

  The \ccc{Planar Map with Intersections} package extends the
  functionality of the \ccc{Planar Map} package by enabling simple
  insertion of intersecting not necessarily $x$-monotone curves. The
  \ccc{Planar_map_with_intersections_2} class has different insertion
  functions but it uses the same data structures as the planar
  map. Therefore, almost any functionality of the planar map is also
  supported here (e.g., traversal of planar map features, point
  location queries and I/O operations are supported but infinite
  objects are not supported). However, the planar map with
  intersections needs additional intersection functions in the
  geometric traits class. Note that if one needs to build a planar map
  of $x$-monotone, pairwise interior disjoint curves, then it would be
  more efficient (in running time) and less demanding (in traits class
  functionality) to use the planar map class.

\paragraph{Degeneracies} 
  Like the \ccc{Planar Map} package (see
  Chapter~\ref{I1_ChapterPlanarMap}), the \ccc{Planar Map with
  Intersections} package can deal with $x$-degenerate input (including
  vertical segments). However, while in the planar map the input
  curves were assumed to be non intersecting in their interiors, there
  is no such assumption when using planar map with
  intersections. Furthermore, overlapping curves are supported. If two
  curves overlap the traits intersection function returns the two
  endpoints of the common part.

% \paragraph{Sweep line}
%   A \ccc{Planar Map with Intersections} can be built incrementally by
%   inserting one curve after the other into the map. For a big number
%   of curves it is much faster to perform the sweep line algorithm on
%   the collection of input curves. A sweep line utility is supported as
%   part of the package. The utility can either build the induced planar
%   map or rather collect the pairwise interior disjoint subcurves
%   computed in a container. 

%   If no additional insertions of intersecting curves are planned
%   following the building of the map it is possible to perform a sweep
%   line operation that will build the simpler class \ccc{Planar_map_2}.
%   This is possible since the output of the sweep line operation is a
%   collection of $x$-monotone pairwise interior disjoint, which are
%   supported by the \ccc{Planar Map} package. The result of applying
%   the sweep line algorithm to a collection of curves and a non-empty
%   map is equal to that of applying the algorithm to the union of the
%   planar map curves and the collection of input curves. Simply put,
%   the intersections of input curves and planar map curves are also
%   calculated.

%---------------------------------------------------
\subsection{A Simple Program}
\label{ssec:example1}
The simple program listed below demonstrates the construction of an
$X$-shaped planar subdivision out of two intersecting segments.
The coordinates of the halfedges of the constructed subdivision are
printed to standard output.

\ccIncludeExampleCode{Pm_with_intersections/example1.C}

The output of the program looks like this:
\begin{verbatim}
Inserting the segments:
0 0 1 1
0 1 1 0

Edges of the planar map:
0 0 --- 0.5 0.5
0.5 0.5 --- 1 1
0 1 --- 0.5 0.5
1 0 --- 0.5 0.5
\end{verbatim}


% \subsection{Example of Sweep Line}
% \label{ssec:example1_sweep}
%   The following example demonstrates the usage of the \ccc {Sweep
%   line} algorithm.  It constructs a planar map out of four segments
%   --- $(0,0)-(1,1)$ , $(0,1)-(1,0)$ , $(0,0)-(1,0)$ and $(0,1)-(1,1)$
%   (an hourglass shape), two of them are intersecting in their
%   interior.  The resulting planar map will contain all the disjoint
%   interior sub-segments obtained by the calculation of the sweep
%   line algorithm. For clarity, we printed all the halfedges of the
%   resulting planar map to the standard output using the I/O functions
%   for the \ccc{Planar map} package.

% \ccIncludeExampleCode{Sweep_line/example1.C}

% The output of the program looks like this:

% \ccIncludeExampleCode{Sweep_line/example1.cout}

\begin{ccAdvanced}
\subsection{Change Notification}
%-----------------------------------------------
  An insertion of an intersecting curve into a planar map may add
  several halfedges and modify several features of the map (i.e.,
  split halfedges, split faces). The so-called \ccc{Change
  Notification} provides this flexibility. The modification methods
  accept an additional parameter, a class which is a model of the
  \ccc{PlanarMapWithIntersectionsChangeNotification_2} concept. The
  change notification includes an associative function for each
  modification method.  This function is called after each such
  modification.

  The change notification class is useful in many cases. For example,
  one may add a color (or other extra data) to any halfedge of a
  planar map. An insertion of a new curve can split halfedges that
  were previously in the map. After such a split the color of the
  newly created halfedges should be updated according to the original
  color of the split halfedge. One can do this by implementing the
  \ccc{split_edge} function of the change notification class. This
  function will be called after each split of an halfedge in the map.

\subsubsection{Example of Change Notification}
\label{ssecn:example2}
The following example demonstrates the usage of the change
notification concept during the construction of a
planar map out of three segments --- $(0,1)-(1,0)$, $(0,0)-(1,1)$
and $(0,1)-(1,1)$.
During the insertion we use \ccc{My_notification} instance to
output the internal process of the construction of the planar map.
We also count how many edges are in the map by incrementing a
counter each time an edge is added (\ccc{add_edge})or
split (\ccc{split_edge}).

\ccIncludeExampleCode{Pm_with_intersections/example2.C}

The output of the program looks like this:
\begin{verbatim}
inserting 0 1 1 0
add_edge
add_hole
inserting 0 0 1 1
split_edge
add_edge
add_edge
inserting 0 1 1 1
add_edge
split_face
Total number of edges 5
\end{verbatim}

\end{ccAdvanced}

