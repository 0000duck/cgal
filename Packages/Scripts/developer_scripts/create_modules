#!/bin/sh

CVSDIR="/cygdrive/d/CGALCVS"
MODULES_DIRECTORY="Modules"



#check the parameters
while [ ${#} -gt 0 ]; do
  case ${*} in
    -h*|-help*|--help*)
      printf "usage: create_modules (-h|-help|--help)\n\t-d dir\tSets the CVSDIR directory. The default is /cygdrive/d/CGALCVS.\n\t-m mod\tSets the name of the Modules directory from the Installation package. The default name is Modules.\n"
      exit
    ;;
    -d*)
      CVSDIR="$2"
      shift
    ;;
    -m*)
      MODULES_DIRECTORY="$2"
      shift
    ;;
  esac
  shift
done

printf "Setting CVSDIR=${CVSDIR} ...\n"
printf "Setting MODULES_DIRECTORY=${MODULES_DIRECTORY} ...\n"

if [ ! -r ${CVSDIR} ]; then
  printf "Directory ${CVSDIR} does not exist ... EXITING\n"
  return
fi

if [ ! -r create_internal_module ]; then
  printf "create_internal_module file could not be found ... EXITING\n"
  return
fi


cd ${CVSDIR} || return
if [ -r "Installation" ]; then
  printf "Updating package Installation to get the modules list ...\n"
  cvs -q update -P Installation
else
  printf "Checking out package Installation to get the modules list ...\n"
  cvs co -P ${j}
fi

for i in `ls Installation/${MODULES_DIRECTORY}/*`
do
  if [ -f "${i}" ]; then
    MAIN_NAME="`basename ${i}`"
    printf "\n\nCreating module ${MAIN_NAME}\n"
    if [ -r "${MAIN_NAME}" ]; then
      printf "  Directory ${MAIN_NAME} exists, removing ...\n"
      rm -rf ${MAIN_NAME}
    fi
    for j in `cat ${i}`
    do
      if [ -r "${j}" ]; then
        printf "  Updating package ${j} ...\n" 
        cvs -q update ${j}
      else
        printf "  Check out package ${j} ...\n" 
        cvs co -P ${j}
      fi
    done
    ./create_internal_module -m ${MAIN_NAME} -r CGAL-3.1-I-76 -n 1003004200 -a ${CVSDIR} -p ${i} -s "${CVSDIR}/Scripts/scripts"
  fi

done