#!/bin/sh

CVSDIR="/cygdrive/d/CGALCVS"
MODULES_DIRECTORY="Modules"

cd ${CVSDIR} || return
if [ -r "Installation" ]; then
  printf "Updating package Installation to get the modules list ...\n"
  cvs -q update -P Installation
else
  printf "Checking out package Installation to get the modules list ...\n"
  cvs co -P ${j}
fi

for i in `ls Installation/${MODULES_DIRECTORY}/*`
do
  if [ -f "${i}" ]; then
    MAIN_NAME="`basename ${i}`"
    printf "\n\nCreating module ${MAIN_NAME}\n"
    if [ -r "${MAIN_NAME}" ]; then
      printf "  Directory ${MAIN_NAME} exists, removing ...\n"
      rm -rf ${MAIN_NAME}
    fi
    for j in `cat ${i}`
    do
      if [ -r "${j}" ]; then
        printf "  Updating package ${j} ...\n" 
#        cvs update ${j}
      else
        printf "  Check out package ${j} ...\n" 
        cvs co -P ${j}
      fi
    done
    ./create_internal_module -m ${MAIN_NAME} -r CGAL-3.1-I-76 -n 1003004200 -a ${CVSDIR} -p ${i} -s "${CVSDIR}/Scripts/scripts"
  fi

done