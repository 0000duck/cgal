

\qt\ is a {\sc Gui} toolkit\footnote{http://www.trolltech.com} for
cross-platform application development. 

% +-----------------------------------------------------+
\section{Introduction}

This chapter describes classes that help to visualize two dimensional \cgal\ objects
with the \qt\ GraphicsView framework.

This framework uses the model view paradigm. GraphicsItems are stored in a 
GraphicsScene and are displayed in a GraphicsViews. The items 
have a paint method which is called when an item is in the visible area of a view.
The framework is also responsible for dispatching events from the view
via the scene to the items. The framework is extensible in the sense
that users can add classes derived from GraphicsItems.

Besided visualizing GraphicsItems users want to enter geometric objects.
We provide the input generators for all 2D \cgal\ kernel objects.

The package includes also the class \ccc{QtNavigation} providing zooming,
panning, and scrolling.


The following sections describe the interaction between all these classes,
We finally describe the internals of a GraphicsItem.

\subsection{Naming Conventions}

As Qt and \cgal\ have diferent naming conventions, and as this package
brings them togther we adopted the following, hybrid naming conventions.

\begin{itemize}
\item Because it is an I/O related package all header files are in the directory
\ccc{CGAL/IO/}. The letters \ccc{IO} are neither part of the class name, nor 
      of the namespace.
\item Class names are concatenated capitalized words, and function names are
      concatenated capitalized word with the first word in lowercase. The rationale is that
      these classes are related to Qt, and that they sometimes are derived
      classes that have to override member functions adhering to this naming scheme.
\item All classes are in the namespace \ccc{CGAL}.
\end{itemize}
 


\section{Overall Design}

In Figure~\ref{graphicsview:uml} you see four classes depicted in grey,
that come from the Qt GraphicsView framework. It is the \ccc{QGraphicsScene},
which contains \ccc{QGraphicsItems}, which get displayed in any number
of \ccc{QGraphicsViews}.   The views are widgets that is they take screen space
in an application.   

The fourth class is the \ccc{QObject}. It plays an important role in Qt for
event handling. First, it allows to add signals and slots, and to connect them.
Second, it allows to install event filters. 


\begin{figure}[t]
\begin{ccTexOnly}
  \begin{center}
  \includegraphics[width=\linewidth]{GraphicsView/uml-design}
  \end{center}
\end{ccTexOnly}
\begin{ccHtmlOnly}
  <p><center>
  <img src="./uml-design.png" border=0 alt="UML Class Diagram">
  </center>
\end{ccHtmlOnly}
\caption{UML Class Diagram with the Qt classes (blue), \cgal\ classes for using the framework (yellow),
\cgal\ data structures (red), and application classes (green). \label{graphicsview:uml}}
\end{figure}

\subsection{Visualizing CGAL Datastructures}

In order to visualize for example a \ccc{CGAL::Delaunay_triangulation_2<K>}, we
provide the graphics item class \ccc{CGAL::TriangulationGraphicsItem<T>}.
It provides a \ccc{paint} method that draws the edges and vertices of a triangulation
usign the drawing primitives of the \ccc{QPainter}.   The color of vertices and edges, 
can be chosen by setting a user defined  \ccc{QPen}.


As this graphics item only stores a pointer to a triangulation, it
must be notified about changes, as the insertion of points coming from
a file, a process or as input generated with the mouse.  We
use the signal/slot mechanism of Qt for that purpose, that is when the
triangulation changes the application emits a signal that can get connected to the
\ccc{modelChanged()} slot of the graphics item.



\subsection{Navigation}

We provide a class \ccc{QtNavigation} that can be installed as an
event filter of a graphics view and its viewport. Like all Qt widgets
the {QGraphicsView} is derived from
\ccc{QObject} and events like mouse clicks, mouse movements, pressed keys and 
modifier keys are passed to the view which first hands them over to the
event filter.  The \ccc{QtNavigation} event filter allows to zoom, scroll, and recenter.
Finally the class emits a signal with the mouse coordinates. This can be used
to display the current mouse position in the status bar of an application.

\subsection{Generation of Input}

Input of \cgal\ kernel objects, polylines, etc. is generated by classes derived
from \ccc{CGAL::QtInput}.  As the navigation class, they are event handler of the
graphics view, because they have to know where the mouse is, when the user clicks
in order to enter a point.

Once the input generator has assembled the object, which can involve several mouse clicks,
it emits a \ccc{CGAL::Object} wrapping the input.  The emitted input can be connected
by the application developer to a slot. In the 2D demos of \cgal, which use the 
GraphicsView framework we connect it to the slot \ccc{MainWindow::processInput(CGAL::Object)}.
This method unwraps from the \ccc{CGAL::Object} and inserts it in the data structure. 
It then typically emits a signal \ccc{modelChanged()} which the application developer 
connects to the graphics item representing the data structure.

All input generators we provide use the left mouse button for entering points.
The right click terminates a sequence of entered points. 'Delete' and 'backspace'
remove the last entered poin. 'Esc' resets the input generator.  As the 'Ctrl' key
is used by the \ccc{CGAL::QtNavigation} this modifier is not used.  The 'Shift'
key is used for generation of axis aligned segments, rays, and lines. 

\section{How to write a GraphicsItem} 

Explaining the Qt GraphicsView framework is beyond the scope of this manual.
