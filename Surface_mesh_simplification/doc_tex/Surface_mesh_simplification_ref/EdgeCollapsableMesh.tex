%% Copyright (c) 2004  SciSoft.  All rights reserved.
%%
%% This file is part of CGAL (www.cgal.org); you may redistribute it under
%% the terms of the Q Public License version 1.0.
%% See the file LICENSE.QPL distributed with CGAL.
%%
%% Licensees holding a valid commercial license may use this file in
%% accordance with the commercial license agreement provided with the software.
%%
%% This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE
%% WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.
%%
%% 
%%
%% Author(s)     : Fernando Cacciola <fernando_cacciola@hotmail.com>

\begin{ccRefConcept}{EdgeCollapsableMesh}

%% \ccHtmlCrossLink{}     %% add further rules for cross referencing links
%% \ccHtmlIndexC[concept]{} %% add further index entries

\ccDefinition

The concept \ccRefName\ describes the requirements for the type of 
triangulated surface mesh that can be passed to the
simplification algorithm.

The surface must be structurally equivalent to a polyhedral surface
having only triangular faces. 
It can have any number of connected components, boundaries 
(borders and holes) and handles (arbitrary genus).

In the context of this concept, the surface is only required to provide one 
mutating operation: \ccc{collapse_triangulation_edge}.

\ccRefines
\ccc{HalfedgeGraph}

\ccOperations

  \ccFunction
  {template<class Graph>
  void
  collapse_triangulation_edge(typename boost::graph_traits<Graph>::edge_descriptor p_q
                             ,typename boost::graph_traits<Graph>::edge_descriptor p_t
                             ,typename boost::graph_traits<Graph>::edge_descriptor q_b
                             ,Graph& surface
                             );}  
  {Collapses the undirected edge p-q replacing it with one single vertex.\\ 
  Details below ~\ref{SurfaceMeshSimplification:CollapseOperationDetails}.
  }

    
\ccHeading{Collape Operation Semantics}\label{SurfaceMeshSimplification:CollapseOperationDetails}
  
This function assumes the surface to be an {\em open oriented 2-manifold} and it must
never be called in a context were collaping the edge would result in the surface 
becoming a {\em non-manifold}. That is, as a precondition, edge $p-q$ must satisfy
the so-called {\em link-condition}
(whose definition is out of scope for this manual but which is notably explained 
in \cite[Topology preserving edge contraction]{degn-tpec-98}).

The 3 edges must relate to each other as described in the following additional preconditions:

$source(p-q)==source(p-t)$.\\
$target(p-q)==source(q-b)$.\\
One of $p-q$ or $q-p$ is not a border edge.\\
$p-t$ is a null edge iff $p-q$ is a border edge.\\
$q-b$ is a null edge iff $q-p$ is a border edge.\\
if $p-t$ is non-null, $next(t-p)==p-q$.\\
if $q-b$ is non-null, $next(b-q)==q-p$.

The net effect of the operation is equivalent to removing one of the vertices
and re-triangulating the resulting facet, but the actual operation is 
required to remove at most 2 triangles, 3 {\em undirected} edges and 1 vertex, 
as follows:

The triangle above $p-q$ is called {\em top-triangle}.\\
The triangle below $p-q$ is called {\em bottom-triangle}.\\
The triangle adjacent to the top-triangle along $p-t$ is called {\em top-left-triangle}.\\
The triangle adjacent to the bottom-triangle along $q-b$ is called {\em bottom-right-triangle}.

The preconditions guarantee that the top-left-triangle and top-bottom-triangle
are disjoint, that $t-p$ and $p-q$ are both incident on the top-triangle and that
$b-q$ and $q-p$ are both incident on the bottom-triangle.
      
Either $p$ or $q$ is removed, which in turn removes the pair of opposing egdes 
$p-q$ and $q-p$ (that is, the undirected edge $p-q$).

If there is a top-triangle, that is, $p-q$ is not a border edge and $p-t!=null$, it is removed.\\
If there is a bottom triange, that is, $q-p$ is not a border edge and $q-b!=null$, it is removed.\\
(at least one of these triangles exist so at least 1 triangle, and at most 2, are removed).
  
Removing the top-triangle neccesarily removes the pair of opposing edges $p-t$ and $t-p$.\\
Removing the bottom-triangle neccesarily removes the pair of opposing edges $q-b$ and $b-q$.
      
If the bottom-triangle is removed and neither the top-triangle nor
the bottom-right-triangle exist, the vertex removed is $q$. In all other
cases, the vertex removed is $p$.

If any triangle (other than the top and bottom, which are removed) is defined by
the removed vertex, it must be redefined with the other vertex, but it cannot
be replaced by a new triangle. (A model must follow the as-is rule: if it really
needs to do replace triangles, the new triangles must aquire any property 
that could be internally or externally attached to the old triangle)

The function returns the vertex that is not removed.

\ccHasModels
\ccRefIdfierPage{CGAL::Polyhedron_3<Traits>}\\
\ccRefIdfierPage{CGAL::graph_traits< Polyhedron_3<Traits> >}\\
\ccRefIdfierPage{CGAL::halfedge_graph_traits< Polyhedron_3<Traits> >}

\end{ccRefConcept}

% +------------------------------------------------------------------------+
%%RefPage: end of main body, begin of footer
% EOF
% +------------------------------------------------------------------------+
