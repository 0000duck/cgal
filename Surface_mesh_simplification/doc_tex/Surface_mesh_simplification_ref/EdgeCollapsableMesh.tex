%% Copyright (c) 2004  SciSoft.  All rights reserved.
%%
%% This file is part of CGAL (www.cgal.org); you may redistribute it under
%% the terms of the Q Public License version 1.0.
%% See the file LICENSE.QPL distributed with CGAL.
%%
%% Licensees holding a valid commercial license may use this file in
%% accordance with the commercial license agreement provided with the software.
%%
%% This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE
%% WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.
%%
%% 
%%
%% Author(s)     : Fernando Cacciola <fernando_cacciola@hotmail.com>

\begin{ccRefConcept}{EdgeCollapsableMesh}

%% \ccHtmlCrossLink{}     %% add further rules for cross referencing links
%% \ccHtmlIndexC[concept]{} %% add further index entries

\ccDefinition

The concept \ccRefName\ describes the requirements for the type of 
triangulated surface mesh that can be passed to the
simplification algorithm.

The surface must be structurally equivalent to a polyhedral surface
having only triangular faces. 
It can have any number of connected components, boundaries 
(borders and holes) and handles (arbitrary genus).

\ccRefines
\ccc{HalfedgeGraph}

\ccHeading{Valid Expressions}

The mesh simplification algorithm requires the free function \ccc{collapse_triangulation_edge}.


  \ccFunction
  {template<class EdgeCollapsableMesh>
  typename boost::graph_traits<EdgeCollapsableMesh>::vertex_descriptor
  collapse_triangulation_edge(typename boost::graph_traits<EdgeCollapsableMesh>::edge_descriptor ue,
                             EdgeCollapsableMesh& mesh);}  
  {Collapses the undirected edge \ccc{ue} replacing it with one single vertex as described in 
   the following paragraph.}

    

\ccPrecond This function requires \ccc{mesh} to be an oriented 2-manifold (which can be open). Furthermore
the undirected edge $ue$ must satisfy the {\em link condition} \cite{degn-tpec-98},
which guarantees that the surface is also 2-manifold after the edge collapse. 

\smallskip
Let \ccc{v} be the source and \ccc{w} be the target vertices of \ccc{ue}.

For \ccc{e} $\in \{$ \ccc{ue, opposite_edge(ue,mesh)} $\}$, let \ccc{en} and \ccc{ep} be the next and previous 
edges, that is \ccc{en = next_edge(e, mesh)}, \ccc{ep = prev_edge(e,mesh)}, and let 
\ccc{eno} and \ccc{epo} be their opposite edges, that is 
\ccc{eno = opposite_edge(en, mesh)} and \ccc{epo = opposite_edge(ep,mesh)}.

Then, after the collapse of \ccc{ue} the following holds:

\begin{itemize}
\item The edge \ccc{e} is no longer in \ccc{mesh}.
\item One of \ccc{v,w} is no longer in \ccc{mesh} while the other is kept. Let \ccc{r} be the one removed and \ccc{u} be the one kept.
\item If \ccc{e} was a border edge, that is \ccc{get(is_border, e, mesh) == true}, then \ccc{next_edge(ep) == en}, and \ccc{prev_edge(en) == ep}.
\item If \ccc{e} was not a border edge, that is \ccc{get(is_border, e, mesh) == false}, then \ccc{ep} and \ccc{epo} are no longer in \ccc{mesh} while \ccc{en} and \ccc{eno} are kept in \ccc{mesh}.
\item For all edges \ccc{ie} in \ccc{in_edges(r,mesh)}, \ccc{target(ie,mesh) == u} and \ccc{source(opposite_edge(ie),mesh) == u}.
\item No other incidence information has changed in \ccc{mesh}.
\end{itemize}

The function returns vertex \ccc{u}. 

\begin{figure}[htbp]
\begin{ccTexOnly}
\begin{center}
\includegraphics[width=17cm]{Surface_mesh_simplification_ref/fig/general_collapse} % omit suffix .eps to support PS and PDF
\end{center}
\end{ccTexOnly}
\begin{ccHtmlOnly}
<TABLE CELLSPACING=40>
<TR>
<CENTER>
<IMG BORDER=0 SRC="./fig/general_collapse.png" ALIGN=center ALT="Simplification illustration">
</CENTER>
</TR>
</TABLE>
\end{ccHtmlOnly}
\caption{General edge collapse case: The horizontal dotted line is the collapsing edge. Two of its incident edges are removed (dashed lines). The red and magenta lines are the edges which get re-linked to $u$. Blue and cyan lines are the edges left untouched because they are already linked to $u$.}
\end{figure}


\begin{figure}[htbp]
\begin{ccTexOnly}
\begin{center}
\includegraphics[width=17cm]{Surface_mesh_simplification_ref/fig/border_collapse1} % omit suffix .eps to support PS and PDF
\end{center}
\end{ccTexOnly}
\begin{ccHtmlOnly}
<TABLE CELLSPACING=40>
<TR>
<CENTER>
<IMG BORDER=0 SRC="./fig/border_collapse1.png" ALIGN=center ALT="Simplification illustration">
</CENTER>
</TR>
</TABLE>
\end{ccHtmlOnly}
\caption{The case when the collapsing edge is a border. Only one of its incident edges (dashed line) is removed.}
\end{figure}

\begin{figure}[htbp]
\begin{ccTexOnly}
\begin{center}
\includegraphics[width=17cm]{Surface_mesh_simplification_ref/fig/border_collapse3} % omit suffix .eps to support PS and PDF
\end{center}
\end{ccTexOnly}
\begin{ccHtmlOnly}
<TABLE CELLSPACING=40>
<TR>
<CENTER>
<IMG BORDER=0 SRC="./fig/border_collapse3.png" ALIGN=center ALT="Simplification illustration">
</CENTER>
</TR>
</TABLE>
\end{ccHtmlOnly}
\caption{The case when the collapsing edge is not itself a border, but is incident upon a border edge that is removed.}
\end{figure}

\begin{figure}[htbp]
\begin{ccTexOnly}
\begin{center}
\includegraphics[width=17cm]{Surface_mesh_simplification_ref/fig/border_collapse2} % omit suffix .eps to support PS and PDF
\end{center}
\end{ccTexOnly}
\begin{ccHtmlOnly}
<TABLE CELLSPACING=40>
<TR>
<CENTER>
<IMG BORDER=0 SRC="./fig/border_collapse2.png" ALIGN=center ALT="Simplification illustration">
</CENTER>
</TR>
</TABLE>
\end{ccHtmlOnly}
\caption{The case when the collapsing edge is not itself a border, but is incident upon a border edge that is {\em not} removed.}
\end{figure}

\begin{figure}[htbp]
\begin{ccTexOnly}
\begin{center}
\includegraphics[width=17cm]{Surface_mesh_simplification_ref/fig/border_collapse4} % omit suffix .eps to support PS and PDF
\end{center}
\end{ccTexOnly}
\begin{ccHtmlOnly}
<TABLE CELLSPACING=40>
<TR>
<CENTER>
<IMG BORDER=0 SRC="./fig/border_collapse4.png" ALIGN=center ALT="Simplification illustration">
</CENTER>
</TR>
</TABLE>
\end{ccHtmlOnly}
\caption{The single exceptional case when the vertex w instead of v is removed.}
\end{figure}


\begin{figure}[htbp]
\begin{ccTexOnly}
\begin{center}
\includegraphics[width=17cm]{Surface_mesh_simplification_ref/fig/collapse1} % omit suffix .eps to support PS and PDF
\end{center}
\end{ccTexOnly}
\begin{ccHtmlOnly}
<TABLE CELLSPACING=40>
<TR>
<CENTER>
<IMG BORDER=0 SRC="./fig/collapse1.png" ALIGN=center ALT="Simplification illustration">
</CENTER>
</TR>
</TABLE>
\end{ccHtmlOnly}
\caption{Detailed diagram of the collapse operation in a border case.}
\end{figure}
%% figures of simplified surfaces


\ccHasModels
\ccRefIdfierPage{CGAL::Polyhedron_3<Traits>} via external adaptation.

\ccSeeAlso
\ccRefIdfierPage{CGAL::graph_traits< Polyhedron_3<Traits> >}\\
\ccRefIdfierPage{CGAL::halfedge_graph_traits< Polyhedron_3<Traits> >}

\end{ccRefConcept}

% +------------------------------------------------------------------------+
%%RefPage: end of main body, begin of footer
% EOF
% +------------------------------------------------------------------------+
